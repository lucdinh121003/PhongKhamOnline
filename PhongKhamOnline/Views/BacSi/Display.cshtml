@model PhongKhamOnline.Models.BacSi

@{
    ViewData["Title"] = "Display";
}
<style>
    .section-title {
        font-weight: bold;
        margin-bottom: 20px;
        text-align: center;
    }

        /* Định dạng cho các thẻ span và em */
        .section-title h1 {
            color: #3f51b5;
        }

    .container-time {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    .box-time {
        background: #000;
        color: #fff;
        padding:20px;
    }
</style>
<section class="detailt-doctor">
    <div class="container">
        <div class="section-title">
            <h1>
                Thông tin chi tiết
            </h1>
        </div>
        <div class="row">
            <div class="col-4">
                <div style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
                    <img class="w-100" src="@Html.DisplayFor(model => model.AnhDaiDien)">
                </div>
                <div style="margin-top:20px">
                    <h2><strong style="text-transform: uppercase;">THẠC SĨ @Html.DisplayFor(model => model.Ten)</strong></h2>
                    <p>
                        Học hàm, học vị: Thạc sĩ, Bác sĩ
                    </p>
                    <p>
                        Kinh nghiệm: Trên 30 năm
                    </p>
                    <p>
                        Chức vụ: Chuyên gia
                        @{
                            var chuyenMonText = Model.ChuyenMonBacSiId switch
                            {
                                1 => "Tai - Mũi - Họng",
                                2 => "Nội - Soi",
                                3 => "Cơ - Xương - Khớp",
                                _ => ""
                            };
                        }
                        @chuyenMonText
                    </p>
                </div>
            </div>
            <div class="col-8">
                <div>
                    <h3><strong>GIỚI THIỆU</strong></h3>
                    <p>
                        @Html.Raw(Model.MoTa.Replace("\n", "<br />"))
                    </p>

                </div>

                <form>
                    <input type="hidden" id="idUser" value="@Model.UserId" />
                    <div class="form-group">
                        <label for="ngayLamViec">Ngày làm việc</label>
                        <input type="date"
                               class="form-control"
                               id="ngayLamViecUser"
                               name="ngayLamViec"
                               min="@DateTime.Now.ToString("yyyy-MM-dd")"
                               required />
                    </div>

                </form>
                <div id="khungGioContainer" class="form-group mt-3">
                    <h4>Khung giờ</h4>
                    <div id="khungGioList" class="container-time"></div>
                </div>

            </div>
        </div>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
@* <script>
    $(document).ready(function () {
        $('#ngayLamViecUser').on('change', function () {
            var ngayLamViecUser = $(this).val();
            var idUser = $('#idUser').val();

            $.ajax({
                url: '/Doctor/LichLamViecDoctor/GetKhungGioDaDat',
                type: 'GET',
                data: { idUser: idUser, ngayLamViec: ngayLamViecUser },
                success: function (khungGioDaDat) {
                    console.log("khungGioDaDat", khungGioDaDat)
                    // Reset tất cả checkbox
                    var khungGioList = $('#khungGioList');
                    khungGioList.empty();

                    // Tạo checkbox cho mỗi khung giờ
                    if (khungGioDaDat.length === 0) {
                        var checkbox = `<div class="">Bác sĩ không có lịch rảnh hôm nay </label`;
                        khungGioList.append(checkbox);
                        return;
                    }
                    khungGioDaDat.forEach(function (khungGio) {
                        var checkbox = `<div class="box-time" for="khungGio_${khungGio.id}">${khungGio.time}</label`;
                        khungGioList.append(checkbox);
                    });
                },
                error: function () {
                    alert('Có lỗi xảy ra khi tải dữ liệu khung giờ.');
                }
            });
        });
    });
</script> *@
<script>
    $('#ngayLamViecUser').on('change', function () {
        var ngayLamViecUser = $(this).val();
        var idUser = $('#idUser').val();

        $.ajax({
            url: '/Doctor/LichLamViecDoctor/GetKhungGioDaDat',
            type: 'GET',
            data: { idUser: idUser, ngayLamViec: ngayLamViecUser },
            success: function (response) {
                var khungGioList = $('#khungGioList');
                khungGioList.empty();

                if (response.error) {
                    khungGioList.append(`<div class="box-time">${response.error}</div>`);
                    return;
                }

                if (response.message) {
                    khungGioList.append(`<div class="box-time">${response.message}</div>`);
                    return;
                }

                response.forEach(function (khungGio) {
                    var checkbox = `<div class="box-time">${khungGio.time}</div>`;
                    khungGioList.append(checkbox);
                });
            },
            error: function () {
                alert('Có lỗi xảy ra khi tải dữ liệu khung giờ.');
            }
        });
    });

</script>
